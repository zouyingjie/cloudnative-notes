<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>存储原理 | 云原生架构笔记</title><meta name="description" content="构建大规模高可用的分布式系统">
    <link rel="preload" href="/cloudnativenotes/assets/style-C8UjLoOj.css" as="style"><link rel="stylesheet" href="/cloudnativenotes/assets/style-C8UjLoOj.css">
    <link rel="modulepreload" href="/cloudnativenotes/assets/app-C-eiXR-Q.js"><link rel="modulepreload" href="/cloudnativenotes/assets/storage.html-DfrhP5dU.js"><link rel="modulepreload" href="/cloudnativenotes/assets/storage.html-DOJKqM46.js">
    <link rel="prefetch" href="/cloudnativenotes/assets/index.html-CaDEAGlr.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/summary.html-5z9O3CRM.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cron.html-BJpwXMoc.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/distributed-cache.html-BKPXsc_g.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/distributed-lock.html-Bkc2bnt8.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/session.html-DcEZyuC3.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/tracing.html-yfpjvzw7.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/uniqueid.html-DUYGPfKT.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cap.html-B_eIltcI.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/clock.html-KdfBpAtx.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/consistency-and-consensus.html-B_fCTLL3.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/overview.html-Bgzt7s1r.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/sharding-and-replication.html-DUvyRyQl.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/transaction.html-CtA4W0xM.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/about.html-Bj3jP03N.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/dots.html-BFeEvQ5S.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/learn.html-CcJfDuaJ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/perspective.html-Cm4yK9nC.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/responsibility.html-Dim4SFw7.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/toc.html-DvyeioSm.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/01.service-discovery.html-DCArp20B.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/02.service-config.html-wuC-D5mv.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/06.service-health.html-BYhliNkX.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/07.service-resilience-01.html-Dj-QSlZB.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/07.service-resilience-02.html-DUX16yyQ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/08.traffic-schedule.html-Dxbe7Y59.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-Bb_GtxkL.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-fbfqkZuh.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/architecture.html-DJlJ8uIA.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/computing.html-Dcz7xqt8.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/definition.html-DcY1Fd2x.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/pass.html-CpqYH6Ci.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-ahw7-hdr.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-arch.html-BgXIXtLU.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-cgroups.html-oZZix2EO.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-devicemapper.html-CeexLsdc.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-filesystem.html-CqqKrl0p.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-namespace.html-DkDkZSP1.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker.html-BYi6I0z-.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-DZ8leFL_.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cicd.html-BQwJRK1k.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/devops.html-Bkik9OU5.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/gitflow.html-BGbxGwE2.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-D-_Pw43X.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/application.html-DxKvtGl3.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/architecture.html-CgZOV9r7.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cka.html-CPTlxrnN.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/config.html-velI3VEj.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/controller.html-k2T6cqne.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/future.html-BsLZsvYN.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/monitoring.html-DTZQN_t0.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/network.html-DBksTdnb.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/pod.html-DvVxe9V4.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/scheduler.html-CAcDBcea.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/security.html-DWM-cXsC.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-WEBBo--q.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/definition.html-DC1x1JT3.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/logging.html-BmDmiZXu.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/metrics.html-BIerCiie.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/monitoring.html-Dyz9s1ab.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/trace.html-CVfGSZ9N.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/dependency.html-BKhmP467.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/discovery.html-BV343_90.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/lifecycle.html-CDWsGv0r.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/scale.html-H75RsCaz.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/stack.html-r7RjtVmp.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/communication.html-BXw213ih.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/design.html-CTn3BIoS.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/servicemesh.html-DtdX3YpQ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/rest.html-C1iE-8Cc.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/webapi.html-CHk3nZs5.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-9l9raxog.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/history.html-CVrvIJBh.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-9l9raxog.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/mysql.html-C7Za4xWb.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/nosql.html-CZOZOwW8.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/REAEMD.html-CkzaJNpe.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/auth.html-DEvRT4s_.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/permission.html-DxiAcbsM.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/roadmap.html-CSbh4B2o.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/tls-cert.html-lCTnlmUr.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/contract.html-f9rU0CZJ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/function.html-COBB1Ko5.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/load.html-DuAW42s-.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/spring-boot-unit-testing.html-CSz971jG.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/testcontainer.html-DJN5emyo.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/unit-test.html-BuuSHng_.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/availability.html-eZd_Y02n.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/decoupling.html-BoiDHrhp.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/fault-tolerance.html-BN40USBU.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/patterns.html-n88CnXZx.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/redundancy.html-CjCijiXC.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/loadbalancing.html-CWkvv6J6.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/mirroring.html-CpQrip5y.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/rate-limiting.html-4-4WIe2F.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/routing.html-D5F4XlL8.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/404.html-DqZtwkbf.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-DsMxHoe1.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/summary.html-Q6t1kFgr.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cron.html-Dra8Tne5.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/distributed-cache.html-ty6fkx7S.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/distributed-lock.html-IGRU4884.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/session.html-B9otZ8y_.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/tracing.html-DqqQpAG7.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/uniqueid.html-BJ4CDN8L.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cap.html-hpEFshBw.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/clock.html-Bw-k7agB.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/consistency-and-consensus.html-CMgxqBLl.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/overview.html-BDQ2tztl.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/sharding-and-replication.html-BPvJZka6.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/transaction.html-BRXvto4R.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/about.html-bDLcxvSU.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/dots.html-2bB6Ku5l.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/learn.html-D5_C_y2e.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/perspective.html-CuEkVcup.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/responsibility.html-D2uQ6HKY.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/toc.html-CCU8umSy.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/01.service-discovery.html-CJAFPF0c.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/02.service-config.html-C0dT9MoJ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/06.service-health.html-x4gh2uOy.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/07.service-resilience-01.html-C6878baV.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/07.service-resilience-02.html-DC3AQT_a.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/08.traffic-schedule.html-DgSx9VI2.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-Br69DyaM.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-CRtCP2eX.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/architecture.html-ndQf8NmT.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/computing.html-DAdfg3A6.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/definition.html-1slUJu0S.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/pass.html-BI14EvKo.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-ocX59_KX.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-arch.html-sAcu90h4.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-cgroups.html-yRJlFdgp.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-devicemapper.html-DyyGUOsZ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-filesystem.html-B-AjM8BT.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker-namespace.html-CkkVUzCp.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/docker.html-BLzfnp1G.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-Bcpe9sBH.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cicd.html-DnIxr7nV.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/devops.html-rSNNi7J-.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/gitflow.html-CeOrhknP.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-CtiE0YWL.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/application.html-BFOT_eF4.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/architecture.html-Dc4NXGaN.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/cka.html-CgPyOSG3.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/config.html-CqHsKfL2.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/controller.html-DjkUXQkH.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/future.html-D34sD3Y8.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/monitoring.html-CToHqHbr.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/network.html-BJLLLwuE.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/pod.html-wpRnt80g.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/scheduler.html-ChB2Dnju.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/security.html-B1mAlvG1.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-DuVr14wn.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/definition.html-CYhZ0K2_.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/logging.html-DZ1T0vlO.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/metrics.html-NpQXjRPE.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/monitoring.html-BbJFPRdf.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/trace.html-B6jHcs82.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/dependency.html-CLPqcmBN.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/discovery.html-DLnVIG59.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/lifecycle.html-DbMEvmWs.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/scale.html-CD8rqfDC.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/stack.html-y5jQssus.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/communication.html-AUvi7IaZ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/design.html-CmHJURnv.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/servicemesh.html-SLNvveq9.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/rest.html-BuuGuwVc.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/webapi.html-BFHol3Z1.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-BLuU14Un.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/history.html-Bo5Jk6Z9.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/index.html-BLuU14Un.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/mysql.html-DY6VZY0J.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/nosql.html-BnPzgDlf.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/REAEMD.html-B9hyN1MS.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/auth.html-C1IynFQA.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/permission.html-6DRnqYOD.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/roadmap.html-Cj29XfbQ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/tls-cert.html-DQRQ2S_V.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/contract.html-DLjt-c0Q.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/function.html-COQyIpZW.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/load.html-4Xd7pdLN.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/spring-boot-unit-testing.html-DNhjdjQR.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/testcontainer.html-CdxrgXLE.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/unit-test.html-BnApfdzU.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/availability.html-B6i0aGsC.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/decoupling.html-T03ienA-.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/fault-tolerance.html-CoDoYsNs.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/patterns.html-XA-MeAJP.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/redundancy.html-Cw-rGKyJ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/loadbalancing.html-CMPnvy1k.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/mirroring.html-B4Yk6fXQ.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/rate-limiting.html-XirS-n2q.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/routing.html-BqsuJym0.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/404.html-BpKyP9F4.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/giscus-DrGxERkK.js" as="script"><link rel="prefetch" href="/cloudnativenotes/assets/buttons.esm-DK2fWHEW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container" data-v-efed79f6><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/cloudnativenotes/" class=""><img class="logo" src="/cloudnativenotes/images/microservices-logo.svg" alt="云原生架构笔记"><span class="site-name can-hide">云原生架构笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/cloudnativenotes/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zouyingjie/cloudnativenotes/discussions" rel="noopener noreferrer" target="_blank" aria-label="讨论"><!--[--><!--]--> 讨论 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zouyingjie/cloudnativenotes" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/cloudnativenotes/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zouyingjie/cloudnativenotes/discussions" rel="noopener noreferrer" target="_blank" aria-label="讨论"><!--[--><!--]--> 讨论 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/zouyingjie/cloudnativenotes" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/cloudnativenotes/end/about.md" class="sidebar-item sidebar-heading" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/end/toc.md" class="sidebar-item sidebar-heading" aria-label="目录"><!--[--><!--]--> 目录 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading">通用设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item">数据建模 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/common-design/modeling/history.html" class="sidebar-item" aria-label="DBMS的演进"><!--[--><!--]--> DBMS的演进 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/common-design/modeling/" class="sidebar-item" aria-label="数据库索引设计与优化"><!--[--><!--]--> 数据库索引设计与优化 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/common-design/modeling/mysql.html" class="sidebar-item" aria-label="MySQL 开发规范"><!--[--><!--]--> MySQL 开发规范 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/common-design/modeling/nosql.html" class="sidebar-item" aria-label="NoSQL 建模规范"><!--[--><!--]--> NoSQL 建模规范 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">API 设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/common-design/api/rest.html" class="sidebar-item" aria-label="WEB API 设计规范"><!--[--><!--]--> WEB API 设计规范 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/common-design/api/webapi.html" class="sidebar-item" aria-label="Web API 路径设计哪家强"><!--[--><!--]--> Web API 路径设计哪家强 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">认证与授权 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/common-design/security/roadmap.html" class="sidebar-item" aria-label="方案概览"><!--[--><!--]--> 方案概览 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/common-design/security/auth.html" class="sidebar-item" aria-label="身份认证"><!--[--><!--]--> 身份认证 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/common-design/security/permission.html" class="sidebar-item" aria-label="授权管理"><!--[--><!--]--> 授权管理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">分布式系统-理论篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/distributed-system-theory/overview.html" class="sidebar-item" aria-label="分布式系统概览"><!--[--><!--]--> 分布式系统概览 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-theory/sharding-and-replication.html" class="sidebar-item" aria-label="数据分区与复制"><!--[--><!--]--> 数据分区与复制 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-theory/consistency-and-consensus.html" class="sidebar-item" aria-label="分布式共识"><!--[--><!--]--> 分布式共识 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-theory/transaction.html" class="sidebar-item" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-theory/clock.html" class="sidebar-item" aria-label="分布式时钟"><!--[--><!--]--> 分布式时钟 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">分布式系统-工程篇 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/distributed-system-engineering/distributed-lock.html" class="sidebar-item" aria-label="分布式锁的设计"><!--[--><!--]--> 分布式锁的设计 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-engineering/uniqueid.html" class="sidebar-item" aria-label="分布式唯一 ID"><!--[--><!--]--> 分布式唯一 ID <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-engineering/cron.html" class="sidebar-item" aria-label="分布式任务调度"><!--[--><!--]--> 分布式任务调度 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-engineering/session.html" class="sidebar-item" aria-label="分布式会话"><!--[--><!--]--> 分布式会话 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/distributed-system-engineering/tracing.html" class="sidebar-item" aria-label="分布式追踪"><!--[--><!--]--> 分布式追踪 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/cloudnativenotes/cloudnative/summary.md" class="sidebar-item sidebar-heading active" aria-label="云原生架构"><!--[--><!--]--> 云原生架构 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item">什么是云原生 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/architecture/architecture.html" class="sidebar-item" aria-label="分布式系统的演进"><!--[--><!--]--> 分布式系统的演进 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/architecture/definition.html" class="sidebar-item" aria-label="云原生的定义"><!--[--><!--]--> 云原生的定义 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/architecture/pass.html" class="sidebar-item" aria-label="云原生平台的构建"><!--[--><!--]--> 云原生平台的构建 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item active">不可变基础设施 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item">容器 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/container/docker-namespace.html" class="sidebar-item" aria-label="容器基础技术：namespace"><!--[--><!--]--> 容器基础技术：namespace <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/container/docker-cgroups.html" class="sidebar-item" aria-label="容器基础技术：cgroups"><!--[--><!--]--> 容器基础技术：cgroups <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/container/docker-filesystem.html" class="sidebar-item" aria-label="容器基础技术：文件系统"><!--[--><!--]--> 容器基础技术：文件系统 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/container/docker-devicemapper.html" class="sidebar-item" aria-label="容器基础技术：devicemapper"><!--[--><!--]--> 容器基础技术：devicemapper <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/container/docker.html" class="sidebar-item" aria-label="Docker 最佳实践"><!--[--><!--]--> Docker 最佳实践 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item active">Kubernetes <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/kubernetes/architecture.html" class="sidebar-item" aria-label="整体架构"><!--[--><!--]--> 整体架构 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/pod.html" class="sidebar-item" aria-label="Pod 那些事"><!--[--><!--]--> Pod 那些事 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/controller.html" class="sidebar-item" aria-label="控制器对象"><!--[--><!--]--> 控制器对象 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/config.html" class="sidebar-item" aria-label="配置管理对象"><!--[--><!--]--> 配置管理对象 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/network.html" class="sidebar-item" aria-label="网络原理"><!--[--><!--]--> 网络原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloudnativenotes/cloudnative/kubernetes/storage.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="存储原理"><!--[--><!--]--> 存储原理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/cloudnativenotes/cloudnative/kubernetes/storage.html#_1-volumes" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. Volumes"><!--[--><!--]--> 1. Volumes <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloudnativenotes/cloudnative/kubernetes/storage.html#_2-pv-pvc" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. PV &amp; PVC"><!--[--><!--]--> 2. PV &amp; PVC <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/cloudnativenotes/cloudnative/kubernetes/storage.html#_3-dynamic-provisioning" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Dynamic Provisioning"><!--[--><!--]--> 3. Dynamic Provisioning <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloudnativenotes/cloudnative/kubernetes/storage.html#_4-pv-挂载过程" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. PV 挂载过程"><!--[--><!--]--> 4. PV 挂载过程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloudnativenotes/cloudnative/kubernetes/storage.html#_5-csi-插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. CSI 插件"><!--[--><!--]--> 5. CSI 插件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/scheduler.html" class="sidebar-item" aria-label="调度原理"><!--[--><!--]--> 调度原理 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/security.html" class="sidebar-item" aria-label="安全机制"><!--[--><!--]--> 安全机制 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/application.html" class="sidebar-item" aria-label="应用封装与扩展"><!--[--><!--]--> 应用封装与扩展 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/kubernetes/monitoring.html" class="sidebar-item" aria-label="集群监控与 debug"><!--[--><!--]--> 集群监控与 debug <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">服务网格 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/servicemesh/communication.html" class="sidebar-item" aria-label="服务通信的演进"><!--[--><!--]--> 服务通信的演进 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/servicemesh/servicemesh.html" class="sidebar-item" aria-label="服务网格产品与生态"><!--[--><!--]--> 服务网格产品与生态 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/servicemesh/design.html" class="sidebar-item" aria-label="服务网格的设计"><!--[--><!--]--> 服务网格的设计 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">服务治理 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/service/dependency.html" class="sidebar-item" aria-label="服务依赖管理"><!--[--><!--]--> 服务依赖管理 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/service/stack.html" class="sidebar-item" aria-label="服务整栈编排"><!--[--><!--]--> 服务整栈编排 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/service/discovery.html" class="sidebar-item" aria-label="服务注册与发现"><!--[--><!--]--> 服务注册与发现 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/service/lifecycle.html" class="sidebar-item" aria-label="服务生命周期管理"><!--[--><!--]--> 服务生命周期管理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">流量治理 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/service/traffic/loadbalancing.html" class="sidebar-item" aria-label="负载均衡"><!--[--><!--]--> 负载均衡 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/service/traffic/routing.html" class="sidebar-item" aria-label="流量路由"><!--[--><!--]--> 流量路由 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/service/traffic/rate-limiting.html" class="sidebar-item" aria-label="限流设计"><!--[--><!--]--> 限流设计 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/service/traffic/mirroring.html" class="sidebar-item" aria-label="流量镜像"><!--[--><!--]--> 流量镜像 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">可观测性 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/observability/definition.html" class="sidebar-item" aria-label="什么是可观测性"><!--[--><!--]--> 什么是可观测性 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/observability/metrics.html" class="sidebar-item" aria-label="指标"><!--[--><!--]--> 指标 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/observability/logging.html" class="sidebar-item" aria-label="日志"><!--[--><!--]--> 日志 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/observability/trace.html" class="sidebar-item" aria-label="链路追踪"><!--[--><!--]--> 链路追踪 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/observability/monitoring.html" class="sidebar-item" aria-label="全栈监控系统架构"><!--[--><!--]--> 全栈监控系统架构 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">DevOps <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/cloudnative/devops/devops.html" class="sidebar-item" aria-label="打造企业 DevOps 文化"><!--[--><!--]--> 打造企业 DevOps 文化 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/devops/gitflow.html" class="sidebar-item" aria-label="软件开发工作流"><!--[--><!--]--> 软件开发工作流 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/cloudnative/devops/cicd.html" class="sidebar-item" aria-label="CI/CD 最佳实践"><!--[--><!--]--> CI/CD 最佳实践 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">何以为架构师 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloudnativenotes/end/responsibility.html" class="sidebar-item" aria-label="架构师的职责"><!--[--><!--]--> 架构师的职责 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/end/perspective.html" class="sidebar-item" aria-label="架构师的视角"><!--[--><!--]--> 架构师的视角 <!--[--><!--]--></a><!----></li><li><a href="/cloudnativenotes/end/learn.html" class="sidebar-item" aria-label="架构师的学习"><!--[--><!--]--> 架构师的学习 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/cloudnativenotes/end/dots.md" class="sidebar-item sidebar-heading" aria-label="后记：那些平淡的一天"><!--[--><!--]--> 后记：那些平淡的一天 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="存储原理" tabindex="-1"><a class="header-anchor" href="#存储原理" aria-hidden="true">#</a> 存储原理</h1><p>操作系统中有 Volume 和 Mount 的概念。</p><ul><li><strong>Volume</strong>: 表示物理存储的逻辑抽象</li><li><strong>Mount</strong>：将外部存储挂载到系统或容器中。</li></ul><p>为了解决容器的数据存储，Kubernetes 也引入 Volume 的概念。Kubernetes 将 Volume 存储分为了普通的非持久化 Volume 和持久化的 PersistentVolume 两类。</p><h2 id="_1-volumes" tabindex="-1"><a class="header-anchor" href="#_1-volumes" aria-hidden="true">#</a> 1. Volumes</h2><p>普通非持久化 Volume 的目的主要是为了在 Pod 的容器之间共享存储资源，防止 Kubelet 重启容器时造成数据丢失，因此它们的生命周期与 Pod 相同。Pod 中容器的重启不影响 Volume 中的数据存储，只有在 Pod 销毁后 Volume 中的数据才会被删除。</p><p>Kubernetes 默认支持许多种类型的卷，比如 emptyDir，hostPath， configMap、secret downwardAPI 等作为 Volume 挂载到容器中。</p><p>下面看两个常用的类型：</p><ul><li><strong>emptyDir类型</strong>： 临时的卷类型，当一个Pod 被分配到一个 Node 时候被创建，生命周期只维持在该 Pod 依然运行在该节点上的这段时间。在两个容器共享一些临时文件的场景下，可以使用这种类型。</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pd
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/test<span class="token punctuation">-</span>webserver
    <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>container
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /cache
      <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>hostPath类型</strong>：将宿主节点文件系统上的文件或者目录映射到 Pod中。当Pod 需要访问一些宿主节点的数据的场景下可以使用。 Pod 被删除后 Host 上的文件依然存在，当新的 Pod 被调度到节点上挂载 Volume 后会看到对应 path 中的文件。</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>webserver
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>webserver
    <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/test<span class="token punctuation">-</span>webserver<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/local/aaa
      <span class="token key atrule">name</span><span class="token punctuation">:</span> mydir
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/local/aaa/1.txt
      <span class="token key atrule">name</span><span class="token punctuation">:</span> myfile
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mydir
    <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token comment"># Ensure the file directory is created.</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/local/aaa
      <span class="token key atrule">type</span><span class="token punctuation">:</span> DirectoryOrCreate
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myfile
    <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/local/aaa/1.txt
      <span class="token key atrule">type</span><span class="token punctuation">:</span> FileOrCreate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://pub-08b57ed9c8ce4fadab4077a9d577e857.r2.dev/1fa7e08fbe9aed53e93cd5eff367d2e4.png" alt="在这里插入图片描述"></p><p>图片来自 《Kubernetes In Action》</p><ul><li><p><strong>Generic ephemeral</strong>：在 1.19 版本引入，并在 1.23 达到稳定的通用临时卷，和 emptyDir 类似，但相对更加灵活，有以下特性：</p></li><li><p>底层存储即可以是本地存储，也可以是网络存储。</p></li><li><p>可以设置容量上限</p></li><li><p>可以创建初始数据</p></li><li><p>如果底层存储支持，还可以支持快照、克隆、容量调整等操作。</p></li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>frontend
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.28</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/scratch&quot;</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> scratch<span class="token punctuation">-</span>volume
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1000000&quot;</span> <span class="token punctuation">]</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> scratch<span class="token punctuation">-</span>volume
      <span class="token key atrule">ephemeral</span><span class="token punctuation">:</span>
        <span class="token key atrule">volumeClaimTemplate</span><span class="token punctuation">:</span>
          <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
            <span class="token key atrule">labels</span><span class="token punctuation">:</span>
              <span class="token key atrule">type</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>frontend<span class="token punctuation">-</span>volume
          <span class="token key atrule">spec</span><span class="token punctuation">:</span>
            <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;ReadWriteOnce&quot;</span> <span class="token punctuation">]</span>
            <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">&quot;scratch-storage-class&quot;</span>
            <span class="token key atrule">resources</span><span class="token punctuation">:</span>
              <span class="token key atrule">requests</span><span class="token punctuation">:</span>
                <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除此之外还有 ConfigMap、Secret、Downward API、Project Volume、ServiceToken 等类型的临时卷，这里就不一一介绍了。</p><h2 id="_2-pv-pvc" tabindex="-1"><a class="header-anchor" href="#_2-pv-pvc" aria-hidden="true">#</a> 2. PV &amp; PVC</h2><p>除了临时性的存储以及共享文件外，我们还需要持久化的存储，无论 Pod 如何被调度，数据始终是一致的。比如我们在 Kubernetes 部署 MySQL 、MongoDB 等服务，任何时候看到的数据都应该是一样的。</p><p>另外存储媒介是一个底层的实现，Pod 不应该关心具体的底层存储类型。因此为了实现持久化存储并使得底层存储与 Pod 解耦，Kuberetes 提出了 Persistent Volume（持久卷） 的概念，而 Pod 对存储资源的需求则被抽象为了 PersistentVolumeClaim（持久卷声明）。</p><ul><li><p><strong>Persistent Volume</strong>：由集群管理员提供的集群存储声明，和普通的 Volume 没有本质的不同，只是其生命周期独立于任何使用 PV 的 Pod。</p></li><li><p><strong>PersistentVolumeClaim</strong>：由用户（开发人员）提供的存储请求声明。</p></li></ul><p>这样在实际使用时，集群可以预先创建一批 PV 提供存储，而用户则只需要创建 PVC 提出自己的存储需求就行了。Kubernetes 会自动将 PVC 与 PV 进行绑定，在将 PVC 挂载到 Pod 中去，就可以进行数据的读写了。</p><p><img src="https://pub-08b57ed9c8ce4fadab4077a9d577e857.r2.dev/4e6e97d763769fab1268199faf3ac78c.png" alt="在这里插入图片描述"></p><p>图片来自《Kubernetes in Action》</p><p>下面是 PV 和 PVC 是使用示例。</p><p><strong>创建 PV</strong></p><p>下面是分别使用本地磁盘和 NFS 作为底层存储的 PV 示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>volume
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> local
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> manual
  <span class="token key atrule">volumeMode</span><span class="token punctuation">:</span> Filesystem
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Recycle
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mnt/data&quot;</span>
<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
   <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Mi
 <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> ReadWriteMany
 <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
   <span class="token key atrule">server</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>server.default.svc.cluster.local
   <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span>
 <span class="token key atrule">mountOptions</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> nfsvers=4.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>几个关键字段概念如下：</p><ul><li><strong>accessModes</strong>: 访问权限 <ul><li><strong>ReadWriteOnce</strong> 允许读写操作，但只能被单个节点挂载。</li><li><strong>ReadOnlyMany</strong> 只读权限，允许被多个节点挂载。</li><li><strong>ReadWriteMany</strong> 读写权限，允许被多个节点挂载。</li><li><strong>ReadWriteOncePod</strong> 读写权限，允许被单个 Pod 挂载。这是 1.22 引入 在 1.29 达到稳定的新模式。如果要确保整个集群中只有一个 Pod 可以读取或写入该 PVC，可以使用该模式实现。</li></ul></li><li><strong>capacity</strong>: 持久卷的容量大小</li><li><strong>volumeMode</strong>： 持久卷模式 。 <ul><li><strong>Filesystem</strong> 默认的文件系统模式，表示在挂载进 Pod 时如果设备为空，则 Kubernetes 会创建完整的文件系统目录。</li><li><strong>Block</strong>：从 1.18 开始支持 Block 选项，表示卷作为原始的块设备，不会创建文件系统目录。此时 Pod 应用需要知道如何与原始块设备交互。</li></ul></li><li><strong>persistentVolumeReclaimPolicy</strong>：回收策略，当 PVC 解绑或者删除时 PV 数据的管理策略。 <ul><li><strong>Retain</strong> PV 保留数据，需要手动处理。</li><li><strong>Delete</strong>： PV 的底层存储会删除数据。</li><li><strong>Recycle</strong>：回收 PV，Kubernetes 会将 PV 数据清理干净然后 PV 重新变为可用。</li></ul></li></ul><p><strong>创建 PVC</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>claim
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> manual
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 3Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PVC 可以通过 storageClassName、accessModes、volumeMode 以及存储容量大小来选择符合条件的 PV，同时还可以通过标签和 Key 来选择执行 PV 的选择范围。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myclaim
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">volumeMode</span><span class="token punctuation">:</span> Filesystem
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 8Gi
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> slow
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token string">&quot;stable&quot;</span>
    <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">key</span><span class="token punctuation">:</span> environment<span class="token punctuation">,</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> In<span class="token punctuation">,</span> <span class="token key atrule">values</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>dev<span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Pod 挂载 PVC 作为存储</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>storage
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>claim
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;http-server&quot;</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>storage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是 PV 是使用过程中的生命周期：</p><table><thead><tr><th>阶段</th><th></th></tr></thead><tbody><tr><td>Provisioning</td><td>卷资源在供给阶段，有两种方式，管理员手动生成或者系统根据PVC需求动态分配</td></tr><tr><td>Binding</td><td>通过手动分配或者动态分配的方式，系统为一个PCV找到和合适的实际PV，则将两者双向绑定起来。</td></tr><tr><td>Using</td><td>用户实际使用资源时的阶段。也就是在 Pod中像 volume一样使用pvc。</td></tr><tr><td>Protecting</td><td>1. 有活跃的 Pod 正在使用卷时，如果删除PVC会进入这个阶段，此时会延迟删除 PVC 直到没有使用了。2. 如果删除了有绑定 PVC 的 PV，也会进入该阶段，会等到 PV 和PVC 解开绑定后，才会删除PVC。</td></tr><tr><td>Reclaiming</td><td>当用户不再需要 PV 资源了，删除PVC后，卷会进入这个阶段，根据定义PV会有两种处理方式：保留，用来维持卷，提供时间给到手动清理上面的数据删除， PV会被直接删除，包括里面的数据回收，（回收模式已经不再推荐使用）</td></tr></tbody></table><h3 id="_3-dynamic-provisioning" tabindex="-1"><a class="header-anchor" href="#_3-dynamic-provisioning" aria-hidden="true">#</a> 3. Dynamic Provisioning</h3><p>上面提到 PV 是由集群管理员预先创建的，属于静态处理。这里会有两个问题：</p><ul><li><strong>创建不及时</strong>：集群管理员无法及时预知所有的存储需求，一旦 PVC 创建 Pod 部署后没有 PV 可用，会导致 Pod 运行出错。</li><li><strong>需求不匹配</strong>：比如管理员预先创建了 5G 大小的 PV，但此时 Pod 的 PVC 只需要 3G，此时如果绑定会造成 2G 的空间浪费。</li></ul><p>与此同时，对于 PV 中数据的处理方式也不够灵活，除了保留、删除外其实还可以有更细化的处理，比如删除到回收站，保留一段时间后在删除，这些可能都需要管理员对 PV 的底层存储进行手动操作。</p><p>因此为了及时、灵活的分配与管理存储资源，Kubernetes 引入了 Dynamic Provisioning 动态供应的方式，其提供了 StorageClass 资源对象，相当于 PV 的模板，该对象基于一个存储的提供者（Provisioner），比如 NFS，AWS S3 等，当用户需要存储资源时，只需要创建对应的 PVC 并指定 StorageClass，Pod 在创建完成需要使用存储资源时，StorageClass 就会根据需要自动的创建 PV 并绑定 PVC。与之相对的，预建 PV 的形式为成为 Static Provisioning。</p><p><img src="https://pub-08b57ed9c8ce4fadab4077a9d577e857.r2.dev/764542d2109c7083a6860a4094885baa.png" alt="在这里插入图片描述"></p><p>图片来自《Kubernetes in Action》</p><p>下面是一个使用 aws-ebs 作为 provisioner 的示例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> standard
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> kubernetes.io/aws<span class="token punctuation">-</span>ebs
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> gp2
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Retain
<span class="token key atrule">allowVolumeExpansion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">mountOptions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> debug
<span class="token key atrule">volumeBindingMode</span><span class="token punctuation">:</span> Immediate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样在创建 PVC 只需要指定该 StorageClass 就可以了</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>claim
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> standard
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span> 
<span class="token key atrule">storage</span><span class="token punctuation">:</span> 3Gi​
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外可以根据需要实现创建不同的 StorageClass，比如下面使用 gce-pd 的 provisioner 创建的两个 StorageClass：使用标准存储的 slow 和使用 SSD 存储的 fast。在创建 PVC 时就可以根据性能需要选择合适的 StorageClass。这样对存储资源的分配和使用就实现了按需灵活分配的目的，除此之外，还可以在 provisioner 里添加处理代码来管理数据的保存、删除，实现更加灵活的管理。Kubernetes官方已经明确建议废弃Recycle策略，如有这类需求，应由 Dynamic Provisioning 去实现。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> slow
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> kubernetes.io/gce<span class="token punctuation">-</span>pd
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> pd<span class="token punctuation">-</span>standard
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fast
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> kubernetes.io/gce<span class="token punctuation">-</span>pd
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> pd<span class="token punctuation">-</span>ssd
<span class="token punctuation">-</span><span class="token punctuation">-</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> claim1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> fast
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 30Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-pv-挂载过程" tabindex="-1"><a class="header-anchor" href="#_4-pv-挂载过程" aria-hidden="true">#</a> 4. PV 挂载过程</h3><p>PV 持久化存储大多数时都是依赖一个远程存储服务，比如 NFS、AWS S3 等远程存储。类比操作系统中的引入存储设备的流程，首先我们需要准备好存储设备，然后将其作为块设备附加到系统中，最后挂载到文件系统，就可以进行读写操作了。Kubernetes 中的操作也是类似的流程：</p><ul><li><strong>准备操作（Provision）</strong>：由各个存储插件准备好自己的存储空间，相当于给 Kuberetes 准备一块磁盘。</li><li><strong>附加操作（Attach）</strong>: Pod 调度完成后，会执行 Reserve 操作，将相关资源预留准备好。对于存储会将远程存储添加到本地，相当于将磁盘添加到 Kubernetes。比如使用 GCE Disk 服务，此时需要 kubelet 调用 GCE Disk 的 API 将远程存储添加到宿主机。</li><li><strong>挂载操作（Mount）</strong>：存储块添加完成后，Kuberetes 会格式化目录并将块设备挂载到宿主机的挂载点，这样在 Pod 中挂载卷时，写入到对应目录的数据就会写到远程存储中去。卷目录一般是 ​ <code>/var/lib/kubelet/pods/&lt;Pod的ID&gt;/volumes/kubernetes.io~&lt;Volume类型&gt;/&lt;Volume名字&gt;​</code>。</li></ul><p>比如使用 EaseMesh 时 Control Plane 的 Pod 有三个卷，其中一个为持久卷，则在 Pod 的宿主机上述目录下就能找到对应卷的目录和数据。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node:➜  ~  <span class="token operator">|</span><span class="token operator">&gt;</span>kubectl get pods <span class="token parameter variable">-n</span> easemesh <span class="token parameter variable">-o</span> wide                                                                                                                                                                                        <span class="token punctuation">[</span>~<span class="token punctuation">]</span>
NAME                                                 READY   STATUS    RESTARTS   AGE     IP              NODE    NOMINATED NODE   READINESS GATES
easemesh-control-plane-1                             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2d19h   <span class="token number">10.233</span>.67.90    <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>


node:➜  ~  <span class="token operator">|</span><span class="token operator">&gt;</span>kubectl describe pod easemesh-control-plane-1 <span class="token parameter variable">-n</span> easemesh                                                                                                                                                                   <span class="token punctuation">[</span>~<span class="token punctuation">]</span>
Name:         easemesh-control-plane-1
<span class="token punctuation">..</span>.
Volumes:
  easegress-control-plane-pv:
    Type:       PersistentVolumeClaim <span class="token punctuation">(</span>a reference to a PersistentVolumeClaim <span class="token keyword">in</span> the same namespace<span class="token punctuation">)</span>
    ClaimName:  easegress-control-plane-pv-easemesh-control-plane-1
    ReadOnly:   <span class="token boolean">false</span>
  easemesh-cluster-cm:
    Type:      ConfigMap <span class="token punctuation">(</span>a volume populated by a ConfigMap<span class="token punctuation">)</span>
    Name:      easemesh-cluster-cm
    Optional:  <span class="token boolean">false</span>
  default-token-tcdjd:
    Type:        Secret <span class="token punctuation">(</span>a volume populated by a Secret<span class="token punctuation">)</span>
    SecretName:  default-token-tcdjd
    Optional:    <span class="token boolean">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在基于 PodId 和 VolumeName 查看下宿主机的挂载目录，就会有对应的文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node:➜  ~  <span class="token operator">|</span><span class="token operator">&gt;</span>sudo <span class="token function">ls</span> <span class="token parameter variable">-l</span>  /var/lib/kubelet/pods/1e2cfc60-493e-4bd3-804b-695e7c0af24f/volumes/                                                                                                                                             <span class="token punctuation">[</span>~<span class="token punctuation">]</span>
total <span class="token number">12</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 kubernetes.io~configmap
drwxr-x--- <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 kubernetes.io~local-volume
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 kubernetes.io~secret


node:➜  ~  <span class="token operator">|</span><span class="token operator">&gt;</span>sudo <span class="token function">ls</span> <span class="token parameter variable">-l</span>  /var/lib/kubelet/pods/1e2cfc60-493e-4bd3-804b-695e7c0af24f/volumes/kubernetes.io~configmap                                                                                                                      <span class="token punctuation">[</span>~<span class="token punctuation">]</span>
total <span class="token number">4</span>
drwxrwxrwx <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 easemesh-cluster-cm


node:➜  ~  <span class="token operator">|</span><span class="token operator">&gt;</span>sudo <span class="token function">ls</span> <span class="token parameter variable">-l</span>  /var/lib/kubelet/pods/1e2cfc60-493e-4bd3-804b-695e7c0af24f/volumes/kubernetes.io~local-volume                                                                                                                   <span class="token punctuation">[</span>~<span class="token punctuation">]</span>
total <span class="token number">4</span>
drwxr-xr-x <span class="token number">5</span> ubuntu ubuntu <span class="token number">4096</span> Jun <span class="token number">23</span> 06:59 easemesh-storage-pv-3

node:➜  ~  <span class="token operator">|</span><span class="token operator">&gt;</span>sudo <span class="token function">ls</span> <span class="token parameter variable">-l</span>  /var/lib/kubelet/pods/1e2cfc60-493e-4bd3-804b-695e7c0af24f/volumes/kubernetes.io~local-volume/easemesh-storage-pv-3                                                                                             <span class="token punctuation">[</span>~<span class="token punctuation">]</span>
total <span class="token number">12</span>
drwx------ <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 data
drwx------ <span class="token number">2</span> root root <span class="token number">4096</span> Jun <span class="token number">23</span> 07:00 log
drwx------ <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 member
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到在持久卷对应的目录下有数据、日志等目录，而这些就是我们持久卷存储中的数据。我们用的宿主机磁盘的 <code>/volumes/easemesh-storage</code> 作为存储，因此在该目录下也会看到相同的文件：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node:➜  /volumes  <span class="token operator">|</span><span class="token operator">&gt;</span>kubectl describe  <span class="token function">pv</span> easemesh-storage-pv-3                                                                                                                                                                    <span class="token punctuation">[</span>/volumes<span class="token punctuation">]</span>
Name:              easemesh-storage-pv-3
Labels:            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:       pv.kubernetes.io/bound-by-controller: <span class="token function">yes</span>
Finalizers:        <span class="token punctuation">[</span>kubernetes.io/pv-protection<span class="token punctuation">]</span>
StorageClass:      easemesh-storage
Status:            Bound
Claim:             easemesh/easegress-control-plane-pv-easemesh-control-plane-1
Reclaim Policy:    Delete
Access Modes:      RWO
VolumeMode:        Filesystem
Capacity:          4Gi
Node Affinity:
  Required Terms:
    Term <span class="token number">0</span>:        kubernetes.io/hostname <span class="token keyword">in</span> <span class="token punctuation">[</span>node4<span class="token punctuation">]</span>
Message:
Source:
    Type:  LocalVolume <span class="token punctuation">(</span>a persistent volume backed by <span class="token builtin class-name">local</span> storage on a <span class="token function">node</span><span class="token punctuation">)</span>
    Path:  /volumes/easemesh-storage
Events:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

node:➜  /volumes  <span class="token operator">|</span><span class="token operator">&gt;</span>ls <span class="token parameter variable">-l</span> /volumes/easemesh-storage                                                                                                                                                                               <span class="token punctuation">[</span>/volumes<span class="token punctuation">]</span>
total <span class="token number">12</span>
drwx------ <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 data
drwx------ <span class="token number">2</span> root root <span class="token number">4096</span> Jun <span class="token number">23</span> 07:00 log
drwx------ <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">12</span>:45 member
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上步骤是由 Kubernetes 的 PersistentVolume Controller、AttachDetach Controller 控制器以及 Kubelet 中的 Volume Manager 来实现。</p><ul><li><strong>PersistentVolume Controller</strong>：执行控制循环，保证所有绑定的 PV 都是可用的以及所有的 PVC 都能与合适的 PV 绑定。在执行拟合的过程中，Controller 会根据需要调用存储驱动插件的 Provision/Delete 接口进行操作。</li><li><strong>AttachDetach Controller</strong>：在 PV 与 PVC 绑定， Pod 被调度到某个节点后，执行 Attach 操作，将远程存储添加到宿主机 Attach 对应的节点。</li><li><strong>Volume Manager</strong>: 这是一个单独的 gorouting，独立于 kubelet 的主循环，执行具体的 Mount 操作，格式化磁盘并将设备挂载到宿主机目录。</li></ul><p>而上述操作完成后，在 Pod 部署创建容器时，Kubelet 就会在启动容器时将我们已挂载的宿主机目录在挂载进容器中去，相当于执行如下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-v</span> /var/lib/kubelet/pods/<span class="token operator">&lt;</span>Pod的ID<span class="token operator">&gt;</span>/volumes/kubernetes.io~<span class="token operator">&lt;</span>Volume类型<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>Volume名字<span class="token operator">&gt;</span>:/<span class="token operator">&lt;</span>容器内的目标目录<span class="token operator">&gt;</span> <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>以上就是 PV 挂载过程的简要概述，当然有挂载就有卸载的操作，以上三步分别对应有 Delete、Detach、Unmount 的相反操作，这里就不做赘述了。</p><h3 id="_5-csi-插件" tabindex="-1"><a class="header-anchor" href="#_5-csi-插件" aria-hidden="true">#</a> 5. CSI 插件</h3><p>除了内置的插件，Kubernetes 还提供了扩展机制来实现自己的存储插件，早期的扩展方式是通过 FlexVolume 实现，在 1.23 版本已经被废弃，目前主要是通过 CSI（Container Storage Interface，容器存储接口）来实现，当前 Kubernetes 中内置的存储插件也在进行 CSI 改造，最终会将内置的插件从 Kubernetes 核心中移植出去。</p><p>上面提到的 PV 挂载过程，在没有 CSI 之前其 Provision、Attach、Mount 等操作最终都是通过 Kubernetes 内置的 Volume 插件完成的。</p><p><img src="https://pub-08b57ed9c8ce4fadab4077a9d577e857.r2.dev/073cd434ff0f06914247104cbeaa4e58.png" alt="在这里插入图片描述"></p><p>图片来自 ​https://medium.com/google-cloud/understanding-the-container-storage-interface-csi-ddbeb966a3b​</p><p>Kubernetes 早期内置了非常多的 Volume 插件，为其广泛推广发挥了重要的作用，但也随之引入了如下问题：</p><ul><li><strong>更新不及时</strong>：插件内置在 Kubernetes 中，导致第三方存储厂商的发布节奏必须和 Kubernetes 保持一致。。</li><li><strong>代码不可控</strong>：很多插件都是由第三方存储厂商提供的可执行命令，将其和 Kubernetes 核心代码放一起会引发可靠性和安全性问题。</li></ul><p>因此 Kubernetes 从 1.14 版本开始了内置插件的外迁工作。和之前看到 CNI 网络接口旨在提供移一致的容器网络操作一样，CSI 则是对所有的容器编排系统，比如 Kubernetes、Docker swarm 提供一致的存储访问接口，第三方存储插件只需要按照 CSI 实现对应的接口实现就可以满足所有系统的需要。</p><p><img src="https://pub-08b57ed9c8ce4fadab4077a9d577e857.r2.dev/1a05996fe55ae9ad0e8cce7583202624.png" alt="在这里插入图片描述"></p><p>​​图片来自 ​https://medium.com/google-cloud/understanding-the-container-storage-interface-csi-ddbeb966a3b​</p><p>使用了 CSI 插件后 Kuberetes 存储架构如下：</p><p><img src="https://pub-08b57ed9c8ce4fadab4077a9d577e857.r2.dev/150953587d80edea73584bdde719bfcf.png" alt="在这里插入图片描述"></p><p>图片来自​https://medium.com/google-cloud/understanding-the-container-storage-interface-csi-ddbeb966a3b​</p><p>CSI 的内容主要包括两部分：</p><p><strong>容器系统的相关操作</strong></p><p>像存储插件的注册移除；与存储插件通信实现；各种对 Volume 的管理，比如调用第三方存储插件进行 Volume 的创建、删除、扩缩容、查询监控信息等。主要包含下面一些组件：</p><ul><li><strong>Driver Register</strong>：将会被 Node Driver Register所取代，负责注册第三方插件。插件注册进 kubelet 后就可以通过 gRPC 与插件进行通信了。</li><li><strong>External Provisioner</strong>：调用第三方插件的接口来完成数据卷的创建与删除操作。</li><li><strong>External Attacher</strong>：调用第三方插件的接口来完成数据卷的挂载和操作。</li><li><strong>External Resizer</strong>：调用第三方插件来完成数据卷的扩容操作。</li><li><strong>External Snapshotter</strong>：调用第三方插件来完成快照的创建和删除操作。</li><li><strong>External Health Monitor</strong>：调用第三方插件来提供度量监控数据功能。</li></ul><p>这部分功能虽然从 Kubernetes 核心代码剥离了出来，但依然由 Kubernetes 官方维护。</p><p><strong>第三方插件的具体操作</strong></p><p>需要由云存储厂商实现来执行具体的操作。比如我们上面提到的 Provision、Attach、Mount 操作。这里主要包含三个服务：</p><ul><li><strong>CSI Identity</strong>：用于对外暴露插件的基本信息，比如插件版本号、插件所支持的CSI规范版本、是否支持存储卷创建及删除功能、是否支持存储卷挂载功能，等等。另外还可以用于检查插件的健康状态，开发者可以通过实现 Probe 接口对外提供存储的健康度量信息。</li></ul><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// IdentityServer is the server API for Identity service.</span>
<span class="token keyword">type</span> IdentityServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token comment">// return the version and name of the plugin</span>
  <span class="token function">GetPluginInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>GetPluginInfoRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>GetPluginInfoResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
  <span class="token comment">// reports whether the plugin has the ability of serving the Controller interface</span>
  <span class="token function">GetPluginCapabilities</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>GetPluginCapabilitiesRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>GetPluginCapabilitiesResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
  <span class="token comment">// called by the CO just to check whether the plugin is running or not</span>
  <span class="token function">Probe</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ProbeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ProbeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>CSI Controller</strong>：提供各种对存储系统也就是 Volume 的管理控制接口，其实就是上面提到的准备和 Attach 阶段。譬如准备和移除存储（Provision、Delete操作）、附加与分离存储（Attach、Detach操作）、对存储进行快照等。存储插件并不一定要实现这个接口的所有方法，对于存储本身就不支持的功能，可以在CSI Identity 服务中声明为不提供。</li></ul><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// ControllerServer is the server API for Controller service.</span>
<span class="token keyword">type</span> ControllerServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">CreateVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>CreateVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>CreateVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">DeleteVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>DeleteVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>DeleteVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ControllerPublishVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ControllerPublishVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ControllerPublishVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ControllerUnpublishVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ControllerUnpublishVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ControllerUnpublishVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ValidateVolumeCapabilities</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ValidateVolumeCapabilitiesRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ValidateVolumeCapabilitiesResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ListVolumes</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ListVolumesRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ListVolumesResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">GetCapacity</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>GetCapacityRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>GetCapacityResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ControllerGetCapabilities</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ControllerGetCapabilitiesRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ControllerGetCapabilitiesResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">CreateSnapshot</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>CreateSnapshotRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>CreateSnapshotResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">DeleteSnapshot</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>DeleteSnapshotRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>DeleteSnapshotResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ListSnapshots</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ListSnapshotsRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ListSnapshotsResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ControllerExpandVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ControllerExpandVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ControllerExpandVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ControllerGetVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ControllerGetVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ControllerGetVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">ControllerModifyVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>ControllerModifyVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>ControllerModifyVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>CSI Node 服务</strong>：Controller 中定义的功能都不是在宿主机层面操作的，这部分操作由 CSI Node 服务实现，也就是上面提到的 mount 阶段。其在集群节点层面执行具体操作，比如将 Volume 分区和格式化、将存储卷挂载到指定目录上或者将存储卷从指定目录上卸载等。</li></ul><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> NodeServer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">NodeStageVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeStageVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeStageVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodeUnstageVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeUnstageVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeUnstageVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodePublishVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodePublishVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodePublishVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodeUnpublishVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeUnpublishVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeUnpublishVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodeGetVolumeStats</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeGetVolumeStatsRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeGetVolumeStatsResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodeExpandVolume</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeExpandVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeExpandVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodeGetCapabilities</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeGetCapabilitiesRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeGetCapabilitiesResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token function">NodeGetInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token operator">*</span>NodeGetInfoRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>NodeGetInfoResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而对于 CSI 插件的编写，其实就是实现上面的三个接口，下面看一个比较简单的 csi-s3 插件的例子，项目目录结构如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>csi-s3
├── cmd
│   └── s3driver
│       ├── Dockerfile
│       ├── Dockerfile.full
│       └── main.go

├── pkg
│   ├── driver
│   │   ├── controllerserver.go
│   │   ├── driver.go
│   │   ├── driver_suite_test.go
│   │   ├── driver_test.go
│   │   ├── identityserver.go
│   │   └── nodeserver.go
│   ├── mounter
│   │   ├── goofys.go
│   │   ├── mounter.go
│   │   ├── rclone.go
│   │   ├── s3backer.go
│   │   └── s3fs.go
│   └── s3
│       └── client.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 pkg/driver 目录下有三个文件：</p><ul><li><strong>identityserver.go</strong> 代表 CSI Identity 服务，提供了 CSI 插件的基本信息，Probe 探针接口等。</li><li><strong>controllerserver.go</strong> 代表 CSI Controller 服务，定义了操作 Volume 的相关操作。</li></ul><p>下面是 CSI 中完整的接口列表，cis-s3 只实现了其中一部分：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// s3 插件的 controller 实现</span>
<span class="token keyword">type</span> controllerServer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  <span class="token operator">*</span>csicommon<span class="token punctuation">.</span>DefaultControllerServer
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>cs <span class="token operator">*</span>controllerServer<span class="token punctuation">)</span> <span class="token function">CreateVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>CreateVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>CreateVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 调用 S3 api 创建存储卷</span>
params <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">GetParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
capacityBytes <span class="token operator">:=</span> <span class="token function">int64</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">GetCapacityRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetRequiredBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
mounterType <span class="token operator">:=</span> params<span class="token punctuation">[</span>mounter<span class="token punctuation">.</span>TypeKey<span class="token punctuation">]</span>
volumeID <span class="token operator">:=</span> <span class="token function">sanitizeVolumeID</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bucketName <span class="token operator">:=</span> volumeID
prefix <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span>

client<span class="token punctuation">,</span> err <span class="token operator">:=</span> s3<span class="token punctuation">.</span><span class="token function">NewClientFromSecret</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">GetSecrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">CreateBucket</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to create bucket %s: %v&quot;</span><span class="token punctuation">,</span> bucketName<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token operator">&amp;</span>csi<span class="token punctuation">.</span>CreateVolumeResponse<span class="token punctuation">{</span>
  Volume<span class="token punctuation">:</span> <span class="token operator">&amp;</span>csi<span class="token punctuation">.</span>Volume<span class="token punctuation">{</span>
     VolumeId<span class="token punctuation">:</span>      volumeID<span class="token punctuation">,</span>
     CapacityBytes<span class="token punctuation">:</span> capacityBytes<span class="token punctuation">,</span>
     VolumeContext<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">GetParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>


<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>cs <span class="token operator">*</span>controllerServer<span class="token punctuation">)</span> <span class="token function">DeleteVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>DeleteVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>DeleteVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>nodeserver.go</strong> 代表CSI Node 服务，定义了在宿主机挂载 Volume 的操作，其实现了 CSI 中 NodeServer 的接口。下面是接口列表，我们提到在 Mount 阶段需要将远程存储作为块设备添加都节点并挂载到对应目录，这两步就是通过 NodeStageVolume 和 NodePublishVolume 实现的。</li></ul><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> nodeServer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token operator">*</span>csicommon<span class="token punctuation">.</span>DefaultNodeServer
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ns <span class="token operator">*</span>nodeServer<span class="token punctuation">)</span> <span class="token function">NodePublishVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>NodePublishVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>NodePublishVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ns <span class="token operator">*</span>nodeServer<span class="token punctuation">)</span> <span class="token function">NodeUnpublishVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeUnpublishVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeUnpublishVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	volumeID <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">GetVolumeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ns <span class="token operator">*</span>nodeServer<span class="token punctuation">)</span> <span class="token function">NodeStageVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeStageVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeStageVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ns <span class="token operator">*</span>nodeServer<span class="token punctuation">)</span> <span class="token function">NodeUnstageVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeUnstageVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeUnstageVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token comment">// NodeGetCapabilities returns the supported capabilities of the node server</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>ns <span class="token operator">*</span>nodeServer<span class="token punctuation">)</span> <span class="token function">NodeGetCapabilities</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeGetCapabilitiesRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeGetCapabilitiesResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// currently there is a single NodeServer capability according to the spec</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ns <span class="token operator">*</span>nodeServer<span class="token punctuation">)</span> <span class="token function">NodeExpandVolume</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeExpandVolumeRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>csi<span class="token punctuation">.</span>NodeExpandVolumeResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>csi<span class="token punctuation">.</span>NodeExpandVolumeResponse<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>codes<span class="token punctuation">.</span>Unimplemented<span class="token punctuation">,</span> <span class="token string">&quot;NodeExpandVolume is not implemented&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">checkMount</span><span class="token punctuation">(</span>targetPath <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>三个服务都是通过 gRPC 与 Kubernetes 进行通信的，下面是服务的启动代码，这里定义了 Driver 的版本信息和插件名，CSI 插件要求名字遵守 反向 DNS 格式。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  vendorVersion <span class="token operator">=</span> <span class="token string">&quot;v1.2.0-rc.1&quot;</span>
  driverName    <span class="token operator">=</span> <span class="token string">&quot;ch.ctrox.csi.s3-driver&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// New initializes the driver</span>
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>nodeID <span class="token builtin">string</span><span class="token punctuation">,</span> endpoint <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>driver<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  d <span class="token operator">:=</span> csicommon<span class="token punctuation">.</span><span class="token function">NewCSIDriver</span><span class="token punctuation">(</span>driverName<span class="token punctuation">,</span> vendorVersion<span class="token punctuation">,</span> nodeID<span class="token punctuation">)</span>
  <span class="token keyword">if</span> d <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
     glog<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to initialize CSI Driver.&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  s3Driver <span class="token operator">:=</span> <span class="token operator">&amp;</span>driver<span class="token punctuation">{</span>
     endpoint<span class="token punctuation">:</span> endpoint<span class="token punctuation">,</span>
     driver<span class="token punctuation">:</span>   d<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> s3Driver<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s3 <span class="token operator">*</span>driver<span class="token punctuation">)</span> <span class="token function">newIdentityServer</span><span class="token punctuation">(</span>d <span class="token operator">*</span>csicommon<span class="token punctuation">.</span>CSIDriver<span class="token punctuation">)</span> <span class="token operator">*</span>identityServer <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>identityServer<span class="token punctuation">{</span>
     DefaultIdentityServer<span class="token punctuation">:</span> csicommon<span class="token punctuation">.</span><span class="token function">NewDefaultIdentityServer</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s3 <span class="token operator">*</span>driver<span class="token punctuation">)</span> <span class="token function">newControllerServer</span><span class="token punctuation">(</span>d <span class="token operator">*</span>csicommon<span class="token punctuation">.</span>CSIDriver<span class="token punctuation">)</span> <span class="token operator">*</span>controllerServer <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>controllerServer<span class="token punctuation">{</span>
     DefaultControllerServer<span class="token punctuation">:</span> csicommon<span class="token punctuation">.</span><span class="token function">NewDefaultControllerServer</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s3 <span class="token operator">*</span>driver<span class="token punctuation">)</span> <span class="token function">newNodeServer</span><span class="token punctuation">(</span>d <span class="token operator">*</span>csicommon<span class="token punctuation">.</span>CSIDriver<span class="token punctuation">)</span> <span class="token operator">*</span>nodeServer <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>nodeServer<span class="token punctuation">{</span>
     DefaultNodeServer<span class="token punctuation">:</span> csicommon<span class="token punctuation">.</span><span class="token function">NewDefaultNodeServer</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s3 <span class="token operator">*</span>driver<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token operator">...</span>

  <span class="token comment">// Create GRPC servers</span>
  s3<span class="token punctuation">.</span>ids <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">newIdentityServer</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>driver<span class="token punctuation">)</span>
  s3<span class="token punctuation">.</span>ns <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">newNodeServer</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>driver<span class="token punctuation">)</span>
  s3<span class="token punctuation">.</span>cs <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">newControllerServer</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>driver<span class="token punctuation">)</span>

  s <span class="token operator">:=</span> csicommon<span class="token punctuation">.</span><span class="token function">NewNonBlockingGRPCServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  s<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>endpoint<span class="token punctuation">,</span> s3<span class="token punctuation">.</span>ids<span class="token punctuation">,</span> s3<span class="token punctuation">.</span>cs<span class="token punctuation">,</span> s3<span class="token punctuation">.</span>ns<span class="token punctuation">)</span>
  s<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上是 csi-c3 的简单示例，在将该插件部署到我们的 Kuberetes 后就可以用该插件作为提供商来动态创建 PV 了。对于 CSI 的部署有一些部署原则：</p><ul><li>CSI Node 服务需要与宿主机节点进行交互，因此需要通过 DaemonSet 在每个节点都启动插件来与 Kubelet 通信。</li><li>通过 StatefulSet 在任意节点启动一个 CSI 插件已提供 CSI Controller 服务。这样可以保证 CSI 服务的稳定性和正确性。</li></ul><p>将 CSI 插件部署后就可以使用 StorageClass 和 PVC 了，示例如下：</p><p><strong>部署 CSI</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ kubectl create <span class="token parameter variable">-f</span> provisioner.yaml
kubectl create <span class="token parameter variable">-f</span> attacher.yaml
kubectl create <span class="token parameter variable">-f</span> csi-s3.yaml
serviceaccount/csi-provisioner-sa created
clusterrole.rbac.authorization.k8s.io/external-provisioner-runner created
clusterrolebinding.rbac.authorization.k8s.io/csi-provisioner-role created
service/csi-provisioner-s3 created
statefulset.apps/csi-provisioner-s3 created
serviceaccount/csi-attacher-sa created
clusterrole.rbac.authorization.k8s.io/external-attacher-runner created
clusterrolebinding.rbac.authorization.k8s.io/csi-attacher-role created
service/csi-attacher-s3 created
statefulset.apps/csi-attacher-s3 created
serviceaccount/csi-s3 created
clusterrole.rbac.authorization.k8s.io/csi-s3 created
clusterrolebinding.rbac.authorization.k8s.io/csi-s3 created
daemonset.apps/csi-s3 created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>使用 CSI</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> ch.ctrox.csi.s3<span class="token punctuation">-</span>driver
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token comment"># specify which mounter to use</span>
  <span class="token comment"># can be set to rclone, s3fs, goofys or s3backer</span>
  <span class="token key atrule">mounter</span><span class="token punctuation">:</span> rclone
  <span class="token comment"># to use an existing bucket, specify it here:</span>
  <span class="token comment"># bucket: some-existing-bucket</span>
  <span class="token key atrule">csi.storage.k8s.io/provisioner-secret-name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/provisioner-secret-namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">csi.storage.k8s.io/controller-publish-secret-name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/controller-publish-secret-namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">csi.storage.k8s.io/node-stage-secret-name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/node-stage-secret-namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">csi.storage.k8s.io/node-publish-secret-name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/node-publish-secret-namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">-</span><span class="token punctuation">-</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>pvc
 <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> ReadWriteOnce
 <span class="token key atrule">resources</span><span class="token punctuation">:</span>
   <span class="token key atrule">requests</span><span class="token punctuation">:</span>
     <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
 <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3
<span class="token punctuation">-</span><span class="token punctuation">-</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>test<span class="token punctuation">-</span>nginx
 <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>test<span class="token punctuation">-</span>nginx
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/www/html
        <span class="token key atrule">name</span><span class="token punctuation">:</span> webroot
 <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> webroot
    <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
      <span class="token key atrule">claimName</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>s3<span class="token punctuation">-</span>pvc
      <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样我们的 Pod 在创建时就会由 S3 提供存储空间，我们对数据的写入最终写入到 S3 中。</p><p>CSI 已经演进为了 Kubernetes 存储操作的标准接口，无论是各个云平台自家的各类存储，还是像 Ceph 等分布式存储提供的实现，都极大的拓宽了我们的选择，CIS 本身也还在不断演进中，未来会有更多的新特性值得我们去学习和探索。</p></div><!--[--><!--[--><div class="page-info" data-v-efed79f6><div class="star" data-v-efed79f6><span data-v-efed79f6><a data-icon="octicon-star" href="https://github.com/zouyingjie/cloudnative-notes">Star 关注</a></span></div><div class="last-updated" data-v-efed79f6><span class="prefix" data-v-efed79f6>总字数:</span><span class="words" data-v-efed79f6>5921</span><span class="prefix" data-v-efed79f6>字</span></div></div><div id="comment" class="giscus-wrapper input-top layout-comment" style="display:block;" data-v-efed79f6><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/zouyingjie/cloudnativenotes/edit/main/cloudnative/kubernetes/storage.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub中编辑"><!--[--><!--]--> 在GitHub中编辑 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: yingjiezou1@gmail.com">zouyingjie</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/cloudnativenotes/cloudnative/kubernetes/network.html" class="" aria-label="网络原理"><!--[--><!--]--> 网络原理 <!--[--><!--]--></a></span><span class="next"><a href="/cloudnativenotes/cloudnative/kubernetes/scheduler.html" class="" aria-label="调度原理"><!--[--><!--]--> 调度原理 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/cloudnativenotes/assets/app-C-eiXR-Q.js" defer></script>
  </body>
</html>
