# 单元测试


### 单元测试的目标

一个好的单元测试应该帮助我们达成以下目标：

- **全面的测试用例**：单元测试应该尽可能覆盖所有可能的场景，包括正常流程、异常流程、边界条件等。从而帮助我们验证程序的正确性。
- **改善代码设计**：单元测试应该帮助我们改善代码设计，减少重复代码，提高代码的可维护性和可读性。



单元测试(Unit Testing), 是针对程序模块(软件设计的最小单位)来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在过程化编程中,一个单元就是单个程序、函数、过程等;对于面向对象编程,最小单元就是方法,包括基类(超类)、抽象类、或者派生类(子类)中的方法。
单元测试的目标是隔离程序部件并证明这些单个部件是正确的。一个单元测试提供了代码片断需要满足的严密的书面规约。 单元测试在软件开发过程的早期就能发现问题。

### 单元测试内容


在单元测试中进行的测试工作主要在下面几个方面对被测模块进行检查: ● 模块接口测试。在单元测试开始时,应该对通过所有被测模块的数据流进行测试。如果数据不能正常地输入及输出,那么其他的全部测试都说明不了问题。
这里主要要测试的是模块运行的正确性,当然,这里面还需要注意的是使用外部资源时,是否检查可用性并及时释放资源。
● 路径和边界测试。检查由于计算错误、判定错误、控制流错误导致的程序错误。由于在测试时不可能做到穷举测试,所以在单元测试时要根据“白盒”测试和“黑盒”测试用例设计方法设计测试用例,对模块中重要的执行路径进行测试。重要的执行路径指那些处在完成单元功能的算法、控制、数据处理等重要位置的执行路径,也指由于控制较复杂而易错的路径,有选择地对执行路径进行测试是一项重要的任务。 这是主要要测试的是业务逻辑或是算法中的一些边界条件测试。
● 错误处理测试。 错误处理路径是可能引发错误处理的路径及进行错误处理的路径,错误出现时错误处理程序重新安排执行路线,或通知用户处理,或干脆停止执行使程序进入一种安全等待状态。测试人员应意识到,每一行程序代码都可能执行到,不能自己认为错误发生的概率很小而不去进行测试。
33/52 ● 局部数据结构测试。 模块的局部数据结构是最常见的错误来源。比如: ○ 不正确或不一致的数据类型说明。
○ 使用尚未赋值或尚未初始化的变量。
○ 错误的初始值或错误的默认值。
○ 变量名拼写错或书写错——使用了外部变量或函数。
○ 不一致的数据类型。
○ 全局数据对模块的影响。
○ 数组越界。
○ 非法指针。
单元测试不可能做到面面俱到,所以要抓重点,这些重点的考量指标有: ● 业务上非常重要的模块(关键业务逻辑) ● 业务逻辑或是控制逻辑复杂的。
● 容易出错的,尤其是条件和状态特别多的情况。
● 不易理解的,即使是自己过段时间也会遗忘的,看不懂自己的代码,单元测试代码有助于理解代码的功能和需求● 后期需求变更可能性相对比较大的,这样后期需求更变修改代码之后就不用太担心写的代码对不对以及是否破坏既存代码逻辑了

### 单元测试规范

单元测试必须达到一定的覆盖率,一般成熟度3级需达到80%以上,单元测试覆盖率的考量方法有: ○ 语句覆盖率:考量测试案例中的有效执行语句占比○ 分支覆盖率:考量测试案例中的有效分支执行占比○ 条件覆盖率:当逻辑判断条件是组合的情况下,是否每种条件可能都有覆盖

有效状态机覆盖:有效状态机覆盖相对复杂,考量多种状态间相互转换关系的覆盖占比● 单元测试是测试单元的外部行为,而不是单元的内部结构● 每个测试是独立的,尽可能做到一个测试一个断言,多次运行同一个测试应该返回同样的结果● 不同的分支需要不同案例,一个单元可能有多个测试案例● 单元测试名称必须清楚表明所以测试的功能和行为● 单元测试代码必须易读易维护,同时需遵循代码规范● 使用Mock模拟外部条件和状态● 避免设置不必要的前提条件和上下文● 不要做出不必要的断言● 单元测试不要用来测试可变的配置

### 如何编写一个好的单元测试


### 测试替身（Test Doubles）

在单元测试中, 有时需要用到测试替身来替代真实的对象, 以便更好地控制测试环境和测试行为。测试替身主要有以下几种类型:

比如常见的对 DAO 对象的依赖。可以使用 Mock 对象来模拟 DAO 的行为, 以便在测试中控制其返回值和交互方式。这样可以避免对真实数据库的依赖, 提高测试的独立性和可控性。

按照其用途